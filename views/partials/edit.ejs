<div
  class="p-4 sm:ml-64 dark:bg-gray-900 dark:text-white min-h-screen flex flex-col"
>
  <div
    class="w-full mt-10 dark:bg-gray-900 dark:text-white flex flex-col flex-1"
  >
    <p class="pt-5 text-2xl">Students Details</p>

    <form action="/search" method="get"><%- include('./search.ejs') %></form>

    <div
      class="bg-white rounded-2xl shadow-sm border border-blue-100 overflow-hidden card-hover h-full flex-1 mb-10"
    >
      <!-- Table Header with Stats -->
      <div class="p-6 border-b border-blue-50">
        <div
          class="flex flex-col md:flex-row md:items-center justify-between gap-4"
        >
          <div>
            <h2 class="text-xl font-bold text-gray-900 mb-1">
              Student Directory
            </h2>
            <p class="text-gray-600">Manage and view all student records</p>
          </div>
          <div class="flex items-center space-x-4">
            <div class="hidden md:block text-sm">
              <span class="text-gray-500">Showing </span>
              <span class="font-semibold text-blue-600" id="selected-count"
                >0</span
              >
              <span class="text-gray-500"> of </span>
              <span class="font-semibold text-blue-600" id="total-students"
                ><%= studentlist.length %></span
              >
              <span class="text-gray-500"> students selected</span>
            </div>
            <button
              id="bulk-actions-btn"
              class="hidden btn-gradient text-white font-medium rounded-xl text-sm px-4 py-2.5 text-center"
            >
              <i class="fas fa-cog mr-2"></i>
              Bulk Actions
            </button>
          </div>
        </div>
      </div>

      <!-- Bulk Actions Panel (Hidden by default) -->
      <div
        id="bulk-actions-panel"
        class="hidden p-4 bg-blue-50 border-b border-blue-100 h-full flex-1"
      >
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <span
              class="text-sm font-medium text-gray-700"
              id="bulk-selected-count"
              >0 students selected</span
            >
            <button
              id="clear-selection"
              class="text-sm text-blue-600 hover:text-blue-800 font-medium"
            >
              Clear selection
            </button>
          </div>
          <div class="flex items-center space-x-3">
            <button
              id="export-selected"
              class="flex items-center text-sm text-gray-700 hover:text-gray-900 font-medium px-3 py-1.5 rounded-lg hover:bg-blue-100 transition-colors"
            >
              <i class="fas fa-file-export mr-2"></i>
              Export
            </button>
            <button
              id="mark-attendance"
              class="flex items-center text-sm text-gray-700 hover:text-gray-900 font-medium px-3 py-1.5 rounded-lg hover:bg-blue-100 transition-colors"
            >
              <i class="fas fa-clipboard-check mr-2"></i>
              Mark Attendance
            </button>
          </div>
        </div>
      </div>

      <!-- Student Table -->
      <div class="overflow-x-auto">
        <table
          class="w-full text-sm text-left text-gray-700"
          id="student-table"
        >
          <thead class="text-xs text-gray-700 uppercase bg-blue-50">
            <tr>
              <!-- Select All Checkbox -->
              <th scope="col" class="px-6 py-4">
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    id="checkbox-all-search"
                    class="w-4 h-4 text-blue-600 bg-white border-blue-300 rounded focus:ring-blue-500 focus:ring-2"
                  />
                  <label for="checkbox-all-search" class="sr-only"
                    >Select all</label
                  >
                </div>
              </th>

              <!-- Student Name -->
              <th scope="col" class="px-6 py-4">
                <div class="flex items-center">
                  <span>Student</span>
                  <button class="ml-1 text-gray-400 hover:text-gray-600">
                    <i class="fas fa-sort"></i>
                  </button>
                </div>
              </th>

              <!-- Class -->
              <th scope="col" class="px-6 py-4">
                <div class="flex items-center">
                  <span>Class</span>
                  <button class="ml-1 text-gray-400 hover:text-gray-600">
                    <i class="fas fa-sort"></i>
                  </button>
                </div>
              </th>

              <!-- Session -->
              <th scope="col" class="px-6 py-4">
                <div class="flex items-center">
                  <span>Session</span>
                  <button class="ml-1 text-gray-400 hover:text-gray-600">
                    <i class="fas fa-sort"></i>
                  </button>
                </div>
              </th>

              <!-- Status -->
              <th scope="col" class="px-6 py-4">
                <div class="flex items-center">
                  <span>Status</span>
                </div>
              </th>

              <!-- Actions -->
              <th scope="col" class="px-6 py-4 text-right">
                <span>Actions</span>
              </th>
            </tr>
          </thead>

          <tbody class="divide-y divide-blue-50">
            <% if (studentlist.length > 0) { %> <% studentlist.forEach((student,
            index) => { %>
            <tr
              class="hover:bg-blue-50/50 transition-colors duration-200"
              data-student-id="<%= student.school_id %>"
            >
              <!-- Checkbox -->
              <td class="px-6 py-4">
                <input
                  type="checkbox"
                  class="student-checkbox w-4 h-4 text-blue-600 bg-white border-blue-300 rounded focus:ring-blue-500 focus:ring-2"
                  data-id="<%= student.school_id %>"
                />
              </td>

              <!-- Student Info with Avatar -->
              <td class="px-6 py-4">
                <div class="flex items-center space-x-4">
                  <div class="relative">
                    <div
                      class="w-12 h-12 rounded-xl overflow-hidden border-2 border-white shadow-sm"
                    >
                      <img
                        class="object-cover w-full h-full"
                        src="<%= student.image %>"
                        alt="<%= student.name %>"
                        onerror="
                          this.src =
                            'https://ui-avatars.com/api/?name=<%= student.name %>&background=63b3ed&color=fff&bold=true'
                        "
                      />
                    </div>
                    <% if (index % 3 === 0) { %>
                    <div
                      class="absolute -bottom-1 -right-1 w-5 h-5 bg-green-500 rounded-full border-2 border-white flex items-center justify-center"
                    >
                      <i class="fas fa-check text-white text-xs"></i>
                    </div>
                    <% } %>
                  </div>
                  <div>
                    <div class="font-semibold text-gray-900">
                      <%= student.name %>
                    </div>
                    <div class="text-sm text-gray-500">
                      <i class="fas fa-user mr-1 text-blue-500"></i>
                      S/O <%= student.father_name %>
                    </div>
                    <div class="text-xs text-gray-400 mt-1">
                      ID:
                      <span class="font-mono"><%= student.school_id %></span>
                    </div>
                  </div>
                </div>
              </td>

              <!-- Class -->
              <td class="px-6 py-4">
                <div class="flex items-center">
                  <div
                    class="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-100 to-blue-50 flex items-center justify-center mr-3"
                  >
                    <i class="fas fa-graduation-cap text-blue-600 text-sm"></i>
                  </div>
                  <div>
                    <div class="font-medium text-gray-900">
                      <%= student.class %>
                    </div>
                    <div class="text-xs text-gray-500">Grade</div>
                  </div>
                </div>
              </td>

              <!-- Session -->
              <td class="px-6 py-4">
                <div
                  class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800"
                >
                  <i class="fas fa-calendar-alt mr-2"></i>
                  <%= student.session %>
                </div>
              </td>

              <!-- Status -->
              <td class="px-6 py-4">
                <% const statuses = ['Active', 'Active', 'Inactive']; %> <%
                const statusColors = ['bg-green-100 text-green-800',
                'bg-green-100 text-green-800', 'bg-gray-100 text-gray-800']; %>
                <% const statusIndex = index % 3; %>
                <div
                  class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium <%= statusColors[statusIndex] %>"
                >
                  <i
                    class="fas fa-circle text-xs mr-2 <%= statusIndex === 0 ? 'text-green-500' : statusIndex === 1 ? 'text-green-500' : 'text-gray-400' %>"
                  ></i>
                  <%= statuses[statusIndex] %>
                </div>
              </td>

              <!-- Actions Dropdown -->
              <td class="px-6 py-4 text-right">
                <div class="flex items-center justify-end space-x-2">
                  <!-- Quick View Button -->
                  <button
                    class="text-blue-600 hover:text-blue-800 p-2 rounded-lg hover:bg-blue-50 transition-colors"
                    onclick="quickViewStudent('<%= student.school_id %>')"
                    title="Quick View"
                  >
                    <i class="fas fa-eye"></i>
                  </button>

                  <!-- Edit Button -->
                  <a
                    href="/student/edit/<%= student.school_id %>"
                    class="text-green-600 hover:text-green-800 p-2 rounded-lg hover:bg-green-50 transition-colors"
                    title="Edit Profile"
                  >
                    <i class="fas fa-edit"></i>
                  </a>

                  <!-- More Actions Dropdown -->
                  <div class="relative">
                    <button
                      id="student-actions-<%= student.school_id %>"
                      data-dropdown-toggle="dropdown-<%= student.school_id %>"
                      class="text-gray-600 hover:text-gray-900 p-2 rounded-lg hover:bg-gray-100 transition-colors z-40"
                      type="button"
                    >
                      <i class="fas fa-ellipsis-v"></i>
                    </button>

                    <!-- Dropdown Menu -->
                    <div
                      id="dropdown-<%= student.school_id %>"
                      class="hidden absolute right-0 mt-2 w-64 bg-white rounded-xl shadow-lg border border-blue-100 z-50 overflow-hidden"
                    >
                      <!-- Dropdown Header -->
                      <div
                        class="p-4 bg-gradient-to-r from-blue-50 to-blue-100/50 border-b border-blue-100"
                      >
                        <div class="font-semibold text-gray-900">
                          <%= student.name %>
                        </div>
                        <div class="text-sm text-gray-600">
                          ID: <%= student.school_id %>
                        </div>
                      </div>

                      <!-- Dropdown Items -->
                      <div class="py-2">
                        <!-- Academic Section -->
                        <div
                          class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider"
                        >
                          Academic
                        </div>
                        <a
                          href="/student/get_marks/<%= student.school_id %>"
                          class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 transition-colors"
                        >
                          <div
                            class="w-8 h-8 rounded-lg bg-gradient-to-br from-purple-100 to-purple-50 flex items-center justify-center mr-3"
                          >
                            <i class="fas fa-chart-line text-purple-600"></i>
                          </div>
                          <div>
                            <div class="font-medium">Edit Marks</div>
                            <div class="text-xs text-gray-500">
                              Update academic records
                            </div>
                          </div>
                        </a>

                        <!-- Documents Section -->
                        <div
                          class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider"
                        >
                          Documents
                        </div>
                        <a
                          href="/generate-report/<%= student.school_id %>"
                          class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 transition-colors"
                        >
                          <div
                            class="w-8 h-8 rounded-lg bg-gradient-to-br from-orange-100 to-orange-50 flex items-center justify-center mr-3"
                          >
                            <i class="fas fa-file-alt text-orange-600"></i>
                          </div>
                          <div>
                            <div class="font-medium">Create Report Card</div>
                            <div class="text-xs text-gray-500">
                              Generate academic report
                            </div>
                          </div>
                        </a>
                        <a
                          href="/generate-certificate/<%= student.school_id %>"
                          class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 transition-colors"
                        >
                          <div
                            class="w-8 h-8 rounded-lg bg-gradient-to-br from-green-100 to-green-50 flex items-center justify-center mr-3"
                          >
                            <i class="fas fa-certificate text-green-600"></i>
                          </div>
                          <div>
                            <div class="font-medium">Generate Certificate</div>
                            <div class="text-xs text-gray-500">
                              Create student certificate
                            </div>
                          </div>
                        </a>
                        <a
                          href="/api/students/get/virual-card/<%= student.school_id %>"
                          target="_blank"
                          class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 transition-colors"
                        >
                          <div
                            class="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-100 to-blue-50 flex items-center justify-center mr-3"
                          >
                            <i class="fas fa-id-card text-blue-600"></i>
                          </div>
                          <div>
                            <div class="font-medium">Virtual ID Card</div>
                            <div class="text-xs text-gray-500">
                              View/Print ID card
                            </div>
                          </div>
                        </a>

                        <!-- Files Section -->
                        <div class="border-t border-blue-100">
                          <a
                            href="/files/one/<%= student.school_id %>"
                            class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 transition-colors"
                          >
                            <div
                              class="w-8 h-8 rounded-lg bg-gradient-to-br from-indigo-100 to-indigo-50 flex items-center justify-center mr-3"
                            >
                              <i class="fas fa-folder text-indigo-600"></i>
                            </div>
                            <div>
                              <div class="font-medium">Manage Files</div>
                              <div class="text-xs text-gray-500">
                                View/Upload documents
                              </div>
                            </div>
                          </a>
                        </div>

                        <!-- Danger Zone -->
                        <div class="border-t border-red-100">
                          <form
                            id="move-to-leaved-form-<%= student.school_id %>"
                            action="/student/mark-left/<%= student.school_id %>"
                            method="POST"
                            onsubmit="
                              return confirm(
                                'Are you sure you want to move this student to leaved students?',
                              );
                            "
                          >
                            <input
                              type="hidden"
                              name="reason"
                              value="Graduated"
                            />
                            <button
                              type="submit"
                              class="flex items-center w-full px-4 py-3 text-sm text-amber-600 hover:bg-amber-50 transition-colors"
                            >
                              <div
                                class="w-8 h-8 rounded-lg bg-gradient-to-br from-amber-100 to-amber-50 flex items-center justify-center mr-3"
                              >
                                <i class="fas fa-user-slash text-amber-600"></i>
                              </div>
                              <div>
                                <div class="font-medium">Mark as Left</div>
                                <div class="text-xs text-amber-500">
                                  Move to leaved students
                                </div>
                              </div>
                            </button>
                          </form>

                          <a
                            href="/delete/<%= student.school_id %>"
                            id="delete-link-<%= student.school_id %>"
                            onclick="
                              return confirm(
                                'Are you sure you want to delete this student? This action cannot be undone.',
                              );
                            "
                            class="flex items-center px-4 py-3 text-sm text-red-600 hover:bg-red-50 transition-colors"
                          >
                            <div
                              class="w-8 h-8 rounded-lg bg-gradient-to-br from-red-100 to-red-50 flex items-center justify-center mr-3"
                            >
                              <i class="fas fa-trash-alt text-red-600"></i>
                            </div>
                            <div>
                              <div class="font-medium">Delete Student</div>
                              <div class="text-xs text-red-500">
                                Permanently remove
                              </div>
                            </div>
                          </a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
            <% }); %> <% } else { %>
            <tr>
              <td colspan="6" class="px-6 py-12 text-center">
                <div class="flex flex-col items-center justify-center">
                  <div class="w-24 h-24 mb-4 text-blue-300">
                    <i class="fas fa-users text-6xl"></i>
                  </div>
                  <h3 class="text-lg font-semibold text-gray-900 mb-2">
                    No Students Found
                  </h3>
                  <p class="text-gray-600 mb-6">
                    There are no student records in the database.
                  </p>
                  <a
                    href="/student/add"
                    class="btn-gradient text-white font-medium rounded-xl px-6 py-3 inline-flex items-center"
                  >
                    <i class="fas fa-plus mr-2"></i>
                    Add First Student
                  </a>
                </div>
              </td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>

      <!-- Table Footer -->
      <div class="px-6 py-4 border-t border-blue-50 bg-blue-50/30">
        <div
          class="flex flex-col md:flex-row md:items-center justify-between gap-4"
        >
          <div class="text-sm text-gray-600">
            Showing <span class="font-semibold text-gray-900">1</span> to
            <span class="font-semibold text-gray-900"
              ><%= studentlist.length %></span
            >
            of
            <span class="font-semibold text-gray-900"
              ><%= studentlist.length %></span
            >
            students
          </div>
          <div class="flex items-center space-x-2">
            <button
              class="px-3 py-2 rounded-lg text-gray-700 hover:bg-white hover:shadow-sm transition-all disabled:opacity-50 disabled:cursor-not-allowed"
              disabled
            >
              <i class="fas fa-chevron-left"></i>
            </button>
            <button
              class="px-3 py-2 rounded-lg text-gray-700 hover:bg-white hover:shadow-sm transition-all"
            >
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick View Modal (Hidden by default) -->
    <div
      id="quick-view-modal"
      class="hidden fixed inset-0 z-50 overflow-y-auto"
    >
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-30"></div>
        <div
          class="relative bg-white rounded-2xl shadow-xl w-full max-w-2xl mx-auto"
        >
          <!-- Modal content will be loaded via JavaScript -->
        </div>
      </div>
    </div>
  </div>
</div>

<script src="/js/confirmDelete.js?v=3"></script>
